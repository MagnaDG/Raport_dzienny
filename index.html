<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raport Produkcji KPI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .table-container {
            width: 100%;
            overflow-x: auto;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid #d1d5db;
            padding: 6px 8px;
            text-align: center;
            font-size: 12px;
            vertical-align: top;
            word-wrap: break-word;
        }
        th {
            background-color: #e5e7eb;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .col-godz { width: 2%; }
        .col-oee { width: 5%; }
        .col-osob-nominal { width: 5%; }
        .col-cc-nominal { width: 5%; }
        .col-osob-real { width: 5%; }
        .col-cc-real { width: 5%; }
        .col-kod { width: 8%; }
        .col-ilosc-plan { width: 5%; }
        .col-ilosc-max { width: 5%; }
        .col-ok { width: 5%; }
        .col-nok { width: 5%; }
        .col-czas-dostepny { width: 6%; }
        .col-postoje { width: 5%; }
        .col-brak-wydajnosci { width: 6%; }
        .col-rozliczenie { width: 6%; }
        .col-straty { width: 27%; }
        
        .header-input, .header-select {
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
        }
        .split-cell {
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding: 0;
            border: none;
        }
        .split-cell > div, .split-cell > select, .split-cell > input {
            padding: 4px;
            height: 30px;
            border: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .split-cell > *:first-child {
            border-bottom: 1px solid #d1d5db;
        }
        .cell-input {
            width: 100%;
            height: 100%;
            border: none;
            text-align: center;
            background-color: transparent;
            box-sizing: border-box;
        }
        .cell-input:focus {
            outline: 1px solid #3b82f6;
        }
        .add-btn {
            cursor: pointer;
            font-weight: bold;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin: 2px;
            color: white;
            user-select: none;
        }
        .blue-plus { background-color: #3b82f6; }
        .green-plus { background-color: #22c55e; }
        .red-minus { background-color: #ef4444; }
        
        .oee-gray { color: #9ca3af; }
        .oee-red { color: #ef4444; }
        .oee-yellow { color: #f59e0b; }
        .oee-green { color: #22c55e; }
    </style>
</head>
<body class="p-4">

    <div id="app" class="space-y-4">
        <!-- Nagłówek -->
        <header class="bg-white p-4 rounded-lg shadow-md flex items-center justify-between flex-wrap gap-4">
            <div class="flex items-center gap-2">
                <label for="report-date" class="font-semibold">DATA:</label>
                <input type="date" id="report-date" class="header-input">
            </div>
            <div class="flex items-center gap-2">
                <label for="line-select" class="font-semibold">LINIA:</label>
                <select id="line-select" class="header-select">
                    <option value="">Wybierz...</option>
                    <option value="LINE_A">Linia A</option>
                    <option value="LINE_B">Linia B</option>
                    <option value="LINE_C">Linia C</option>
                </select>
            </div>
            <div class="flex items-center gap-2">
                <label for="shift-select" class="font-semibold">ZMIANA:</label>
                <select id="shift-select" class="header-select">
                    <option value="I">I</option>
                    <option value="II">II</option>
                    <option value="III">III</option>
                </select>
            </div>
            <div class="flex items-center gap-2">
                <label for="brigade-select" class="font-semibold">BRYGADA:</label>
                <select id="brigade-select" class="header-select">
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="E">E</option>
                    <option value="F">F</option>
                </select>
            </div>
            <div class="flex items-center gap-2">
                <label for="leader-input" class="font-semibold">LIDER:</label>
                <input type="text" id="leader-input" class="header-input" placeholder="Wpisz nazwisko...">
            </div>
            <button id="menu-btn" class="bg-gray-700 text-white px-4 py-2 rounded-md font-semibold hover:bg-gray-800 transition">MENU</button>
        </header>

        <!-- Tabela Produkcyjna -->
        <main class="bg-white p-4 rounded-lg shadow-md">
            <div class="table-container">
                <table id="production-table">
                    <thead>
                        <tr>
                            <th rowspan="2" class="col-godz">GODZ</th>
                            <th rowspan="2" class="col-oee">OEE</th>
                            <th rowspan="2" class="col-osob-nominal">OSÓB NOMINAŁ</th>
                            <th rowspan="2" class="col-cc-nominal">CZAS CYKLU NOMINAŁ (s)</th>
                            <th rowspan="2" class="col-osob-real">OSÓB REAL</th>
                            <th rowspan="2" class="col-cc-real">CC REAL (s)</th>
                            <th rowspan="2" class="col-kod">KOD</th>
                            <th rowspan="2" class="col-ilosc-plan">ILOŚĆ PLAN</th>
                            <th rowspan="2" class="col-ilosc-max">ILOŚĆ MAX</th>
                            <th rowspan="2" class="col-ok">OK</th>
                            <th rowspan="2" class="col-nok">NOK</th>
                            <th rowspan="2" class="col-czas-dostepny">CZAS DOSTĘPNY (min)</th>
                            <th rowspan="2" class="col-postoje">POSTOJE (min)</th>
                            <th rowspan="2" class="col-brak-wydajnosci">BRAK WYDAJNOŚCI (min)</th>
                            <th rowspan="2" class="col-rozliczenie">ROZLICZENIE CZASU (min)</th>
                            <th colspan="5" class="col-straty">STRATY</th>
                        </tr>
                        <tr>
                            <th>POWÓD</th>
                            <th>OPERACJA</th>
                            <th>CZAS (min)</th>
                            <th>ILOŚĆ ZDARZEŃ</th>
                            <th>OPIS</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Wiersze będą dodawane dynamicznie przez JS -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modal MENU -->
    <div id="menu-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-20">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm text-center">
            <h2 class="text-2xl font-bold mb-4">MENU GŁÓWNE</h2>
            <div class="space-y-3">
                 <button id="save-report-btn" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition">Zapisz Raport</button>
                <button id="data-modify-btn" class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700 transition">Modyfikacja Danych</button>
                <button id="close-menu-modal" class="w-full bg-red-500 text-white py-2 rounded-md hover:bg-red-600 transition mt-6">Zamknij</button>
            </div>
        </div>
    </div>

    <!-- Modal Modyfikacji Danych -->
    <div id="data-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-30">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-4xl">
            <h2 class="text-2xl font-bold mb-4">Modyfikacja Danych Produktów</h2>
            <div class="max-h-[60vh] overflow-y-auto">
                <table class="w-full">
                    <thead>
                        <tr>
                            <th>LINIA</th>
                            <th>KOD</th>
                            <th>CZAS CYKLU (s)</th>
                            <th>OSÓB NOMINAŁ</th>
                            <th>STRONA</th>
                            <th>AKCJA</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body">
                        <!-- Wiersze z danymi produktów -->
                    </tbody>
                </table>
            </div>
            <div class="mt-4 flex justify-between">
                <button id="add-data-row-btn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition font-semibold">Dodaj Wiersz</button>
                <div>
                    <button id="save-data-btn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition font-semibold">Zapisz Zmiany</button>
                    <button id="close-data-modal" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition ml-2">Anuluj</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white px-5 py-3 rounded-lg shadow-lg opacity-0 transition-opacity duration-300">
      <p id="toast-message"></p>
    </div>

    <script>
        // Ustawienie dzisiejszej daty
        document.getElementById('report-date').valueAsDate = new Date();
        
        // Dodanie pierwszego wiersza
        addNextHourRow(6, false);
        
        // Obsługa przycisku MENU
        document.getElementById('menu-btn').addEventListener('click', function() {
            document.getElementById('menu-modal').classList.remove('hidden');
        });
        
        // Obsługa zamykania modalu
        document.getElementById('close-menu-modal').addEventListener('click', function() {
            document.getElementById('menu-modal').classList.add('hidden');
        });
        
        // Obsługa przycisku modyfikacji danych
        document.getElementById('data-modify-btn').addEventListener('click', function() {
            const password = prompt("Podaj hasło, aby kontynuować:");
            if (password === "z") {
                document.getElementById('menu-modal').classList.add('hidden');
                document.getElementById('data-modal').classList.remove('hidden');
                renderDataModalTable();
            } else if (password !== null) {
                alert("Nieprawidłowe hasło!");
            }
        });
        
        // Obsługa zamykania modalu danych
        document.getElementById('close-data-modal').addEventListener('click', function() {
            document.getElementById('data-modal').classList.add('hidden');
        });
        
        // Funkcja do dodawania wierszy godzin
        function addNextHourRow(startHour, isChangeover) {
            const tableBody = document.getElementById('table-body');
            const row = document.createElement('tr');
            row.classList.add('hour-row');
            
            const hourText = isChangeover ? `P ${startHour}-${startHour+1}` : `${startHour}-${startHour+1}`;
            
            row.innerHTML = `
                <td class="relative">
                    <div class="font-semibold">${hourText}</div>
                    <div class="absolute bottom-1 right-1 flex">
                        <span class="add-btn blue-plus" title="Dodaj następną godzinę" onclick="addNextHourRow(${startHour+1}, false)">+</span>
                        <span class="add-btn green-plus" title="Dodaj przezbrojenie" onclick="addNextHourRow(${startHour}, true)">+</span>
                        <span class="add-btn red-minus" title="Usuń wiersz" onclick="this.closest('tr').remove()">-</span>
                    </div>
                </td>
                <td class="oee-cell font-bold">0.00%</td>
                <td class="nominal-people-cell">
                     <div class="split-cell">
                        <div>-</div>
                        <div>-</div>
                    </div>
                </td>
                <td class="nominal-cycle-cell">
                     <div class="split-cell">
                        <div>-</div>
                        <div>-</div>
                    </div>
                </td>
                <td><input type="number" class="cell-input real-people" value="0"></td>
                <td class="real-cycle-cell">0.00</td>
                <td>
                    <div class="split-cell">
                        <select class="cell-input code-select-lh">
                            <option value="">Wybierz kod...</option>
                            <option value="KOD1">KOD1</option>
                            <option value="KOD2">KOD2</option>
                            <option value="KOD3">KOD3</option>
                        </select>
                        <select class="cell-input code-select-rh">
                            <option value="">Wybierz kod...</option>
                            <option value="KOD4">KOD4</option>
                            <option value="KOD5">KOD5</option>
                            <option value="KOD6">KOD6</option>
                        </select>
                    </div>
                </td>
                <td class="plan-qty-cell">
                    <div class="split-cell"><div>0</div><div>0</div></div>
                </td>
                <td class="max-qty-cell">
                    <div class="split-cell"><div>0</div><div>0</div></div>
                </td>
                <td>
                    <div class="split-cell">
                        <input type="number" class="cell-input ok-qty-lh" value="0">
                        <input type="number" class="cell-input ok-qty-rh" value="0">
                    </div>
                </td>
                <td>
                    <div class="split-cell">
                        <input type="number" class="cell-input nok-qty-lh" value="0">
                        <input type="number" class="cell-input nok-qty-rh" value="0">
                    </div>
                </td>
                <td><input type="number" class="cell-input available-time" value="60"></td>
                <td class="downtime-cell">0</td>
                <td class="inefficiency-cell">0</td>
                <td class="reconciliation-cell">60</td>
                <td colspan="5" class="p-0">
                    <table class="w-full losses-table">
                        ${Array(5).fill(0).map(() => `
                        <tr class="loss-row">
                            <td>
                                <select class="cell-input loss-reason">
                                    <option value="">--</option>
                                    <option value="BRAK_WYDAJNOSCI">Brak wydajności</option>
                                    <option value="POSTOJ_TECHNICZNY">Postój techniczny</option>
                                    <option value="BRAK_MATERIALU">Brak materiału</option>
                                    <option value="INNE">Inne</option>
                                </select>
                            </td>
                            <td><input type="text" class="cell-input loss-operation"></td>
                            <td><input type="number" step="0.5" class="cell-input loss-time" value="0"></td>
                            <td><input type="number" class="cell-input loss-events" value="1"></td>
                            <td><input type="text" class="cell-input loss-desc"></td>
                        </tr>`).join('')}
                    </table>
                </td>
            `;
            
            tableBody.appendChild(row);
        }
        
        // Funkcja do renderowania tabeli w modalnym oknie danych
        function renderDataModalTable() {
            const dataTableBody = document.getElementById('data-table-body');
            dataTableBody.innerHTML = '';
            
            // Przykładowe dane
            const sampleData = [
                { line: 'LINE_A', code: 'KOD1', cycleTime: 30, people: 4, side: 'LH' },
                { line: 'LINE_A', code: 'KOD2', cycleTime: 45, people: 3, side: 'RH' },
                { line: 'LINE_B', code: 'KOD3', cycleTime: 25, people: 5, side: 'LH' }
            ];
            
            sampleData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <select class="cell-input data-line" data-index="${index}">
                            <option value="LINE_A" ${item.line === 'LINE_A' ? 'selected' : ''}>Linia A</option>
                            <option value="LINE_B" ${item.line === 'LINE_B' ? 'selected' : ''}>Linia B</option>
                            <option value="LINE_C" ${item.line === 'LINE_C' ? 'selected' : ''}>Linia C</option>
                        </select>
                    </td>
                    <td><input type="text" class="cell-input data-code" value="${item.code}" data-index="${index}"></td>
                    <td><input type="number" step="0.1" class="cell-input data-cycle" value="${item.cycleTime}" data-index="${index}"></td>
                    <td><input type="number" class="cell-input data-people" value="${item.people}" data-index="${index}"></td>
                    <td>
                        <select class="cell-input data-side" data-index="${index}">
                            <option value="LH" ${item.side === 'LH' ? 'selected' : ''}>LH</option>
                            <option value="RH" ${item.side === 'RH' ? 'selected' : ''}>RH</option>
                        </select>
                    </td>
                    <td><button class="text-red-500 font-bold delete-data-row" data-index="${index}">Usuń</button></td>
                `;
                dataTableBody.appendChild(row);
            });
            
            // Obsługa przycisku usuwania
            document.querySelectorAll('.delete-data-row').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('tr').remove();
                });
            });
        }
        
        // Dodawanie nowego wiersza w modalu danych
        document.getElementById('add-data-row-btn').addEventListener('click', function() {
            const dataTableBody = document.getElementById('data-table-body');
            const newRow = document.createElement('tr');
            const newIndex = dataTableBody.rows.length;
            
            newRow.innerHTML = `
                <td>
                    <select class="cell-input data-line" data-index="${newIndex}">
                        <option value="LINE_A">Linia A</option>
                        <option value="LINE_B">Linia B</option>
                        <option value="LINE_C">Linia C</option>
                    </select>
                </td>
                <td><input type="text" class="cell-input data-code" placeholder="Nowy kod" data-index="${newIndex}"></td>
                <td><input type="number" step="0.1" class="cell-input data-cycle" value="0" data-index="${newIndex}"></td>
                <td><input type="number" class="cell-input data-people" value="0" data-index="${newIndex}"></td>
                <td>
                    <select class="cell-input data-side" data-index="${newIndex}">
                        <option value="LH">LH</option>
                        <option value="RH">RH</option>
                    </select>
                </td>
                <td><button class="text-red-500 font-bold delete-data-row" data-index="${newIndex}">Usuń</button></td>
            `;
            
            dataTableBody.appendChild(newRow);
            
            // Obsługa przycisku usuwania dla nowego wiersza
            newRow.querySelector('.delete-data-row').addEventListener('click', function() {
                this.closest('tr').remove();
            });
        });
        
        // Obsługa zapisywania danych
        document.getElementById('save-data-btn').addEventListener('click', function() {
            alert('Dane zostały zapisane!');
            document.getElementById('data-modal').classList.add('hidden');
        });
        
        // Obsługa zapisywania raportu
        document.getElementById('save-report-btn').addEventListener('click', function() {
            alert('Raport został zapisany!');
            document.getElementById('menu-modal').classList.add('hidden');
        });
    </script>
</body>
</html>
