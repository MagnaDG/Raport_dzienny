<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Raport z linii</title>
<style>
body {
  font-family: Arial, sans-serif;
  background:#f6f6f6;
  display:flex;
  justify-content:center;
  margin:0;
  padding:0;
}
.page-frame {
  width:850px;
  background:#fff;
  border:3px solid #000;
  padding:28px;
  margin:20px;
  box-sizing:border-box;
}
.menu-bar {
  display:flex;
  justify-content:flex-end;
  margin-bottom:10px;
}
.menu-btn {
  background:#007bff;
  color:#fff;
  border:none;
  padding:8px 16px;
  border-radius:6px;
  cursor:pointer;
}
.dropdown {
  display:none;
  position:absolute;
  top:50px;
  right:50px;
  background:#fff;
  border:1px solid #ccc;
  border-radius:6px;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
  padding:10px;
}
.dropdown button {
  display:block;
  width:100%;
  margin:4px 0;
  background:#f0f0f0;
  border:none;
  padding:6px 10px;
  text-align:left;
  cursor:pointer;
  border-radius:4px;
}
.dropdown button:hover { background:#ddd; }
.top-row {
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom:20px;
}
.line-select { position:relative; }
.line-select select {
  padding:6px 10px;
  width:200px;
}
.line-select::after {
  content:"â–¼";
  position:absolute;
  right:8px;
  top:8px;
  pointer-events:none;
}
.center-area { display:flex; justify-content:center; }
table.report {
  border-collapse:collapse;
  width:500px;
  border:1px solid #000;
}
table.report th, table.report td {
  border:1px solid #000;
  padding:6px;
  text-align:center;
}
.kod-stack {
  display:flex;
  flex-direction:column;
  gap:6px;
}
.kod-stack select { padding:4px; }

/* === MODAL BAZA DANYCH === */
.modal {
  display:none;
  position:fixed;
  top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
}
.modal-content {
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:600px;
  max-height:80%;
  overflow:auto;
}
table.db-table {
  border-collapse:collapse;
  width:100%;
}
table.db-table th, table.db-table td {
  border:1px solid #ccc;
  padding:4px;
  text-align:center;
}
.add-row {
  background:#28a745; color:#fff; border:none;
  padding:4px 10px; border-radius:4px;
  cursor:pointer; margin:5px 0;
}
.delete-row { cursor:pointer; color:red; font-weight:bold; }
.save-btn {
  margin-top:10px;
  background:#007bff;
  color:white;
  border:none;
  padding:6px 14px;
  border-radius:6px;
  cursor:pointer;
}
</style>
</head>
<body>
<div class="page-frame">

  <div class="menu-bar">
    <button class="menu-btn" id="menuToggle">MENU</button>
    <div class="dropdown" id="menuDropdown">
      <button id="openDB">BAZA DANYCH</button>
      <button>INNA OPCJA</button>
    </div>
  </div>

  <div class="top-row">
    <label for="linia">Linia:</label>
    <div class="line-select">
      <select id="linia"></select>
    </div>
  </div>

  <div class="center-area">
    <table class="report">
      <thead>
        <tr><th>GODZ.</th><th>OEE</th><th>KOD</th><th>CC</th></tr>
      </thead>
      <tbody>
        <tr>
          <td>6 - 7</td>
          <td></td>
          <td>
            <div class="kod-stack">
              <select id="kod1"></select>
              <select id="kod2"></select>
            </div>
          </td>
          <td><input id="cc" style="width:60px;text-align:center;" /></td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

<!-- Modal Baza Danych -->
<div class="modal" id="dbModal">
  <div class="modal-content">
    <h3>Baza danych</h3>
    <button class="add-row" id="addRow">âž• Dodaj wiersz</button>
    <table class="db-table" id="dbTable">
      <thead><tr><th>LINIA</th><th>KOD</th><th>CC</th><th>OSÃ“B</th><th></th></tr></thead>
      <tbody></tbody>
    </table>
    <button class="save-btn" id="saveDB">Zapisz</button>
  </div>
</div>

<script>
const menuBtn = document.getElementById("menuToggle");
const menuDropdown = document.getElementById("menuDropdown");
menuBtn.addEventListener("click", () => {
  menuDropdown.style.display = menuDropdown.style.display === "block" ? "none" : "block";
});

const dbModal = document.getElementById("dbModal");
document.getElementById("openDB").addEventListener("click", () => {
  dbModal.style.display = "flex";
  menuDropdown.style.display = "none";
  loadTable();
});

dbModal.addEventListener("click", e => {
  if (e.target === dbModal) dbModal.style.display = "none";
});

document.getElementById("addRow").addEventListener("click", () => {
  const tbody = document.querySelector("#dbTable tbody");
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td contenteditable></td>
    <td contenteditable></td>
    <td contenteditable></td>
    <td contenteditable></td>
    <td class="delete-row">ðŸ—‘</td>`;
  tbody.appendChild(tr);
});

document.getElementById("dbTable").addEventListener("click", e => {
  if (e.target.classList.contains("delete-row")) {
    e.target.parentElement.remove();
    refreshLines();
  }
});

document.getElementById("saveDB").addEventListener("click", () => {
  const rows = [];
  document.querySelectorAll("#dbTable tbody tr").forEach(tr => {
    const cells = tr.querySelectorAll("td");
    rows.push({
      linia: cells[0].innerText.trim(),
      kod: cells[1].innerText.trim(),
      cc: cells[2].innerText.trim(),
      osob: cells[3].innerText.trim()
    });
  });
  localStorage.setItem("dbData", JSON.stringify(rows));
  dbModal.style.display = "none";
  refreshLines();
});

// ---- funkcje ----
function loadTable(){
  const tbody = document.querySelector("#dbTable tbody");
  tbody.innerHTML="";
  const data = JSON.parse(localStorage.getItem("dbData")||"[]");
  data.forEach(row=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td contenteditable>${row.linia}</td>
      <td contenteditable>${row.kod}</td>
      <td contenteditable>${row.cc}</td>
      <td contenteditable>${row.osob}</td>
      <td class="delete-row">ðŸ—‘</td>`;
    tbody.appendChild(tr);
  });
}

function refreshLines(){
  const data = JSON.parse(localStorage.getItem("dbData")||"[]");
  const linie = [...new Set(data.map(r=>r.linia))];
  const sel = document.getElementById("linia");
  sel.innerHTML = "<option>-- wybierz --</option>";
  linie.forEach(l=>{
    const opt=document.createElement("option");
    opt.value=opt.textContent=l;
    sel.appendChild(opt);
  });
}
refreshLines();

document.getElementById("linia").addEventListener("change", e => {
  const selected = e.target.value;
  const data = JSON.parse(localStorage.getItem("dbData")||"[]")
                .filter(r=>r.linia===selected);
  const kody=[...new Set(data.map(r=>r.kod))];
  const kod1=document.getElementById("kod1");
  kod1.innerHTML="<option>-- wybierz kod --</option>";
  kody.forEach(k=>{
    const opt=document.createElement("option");
    opt.value=opt.textContent=k;
    kod1.appendChild(opt);
  });
  document.getElementById("kod2").innerHTML="<option>-- wybierz kod --</option>";
});

document.getElementById("kod1").addEventListener("change", e=>{
  const linia=document.getElementById("linia").value;
  const selectedKod=e.target.value;
  const data=JSON.parse(localStorage.getItem("dbData")||"[]")
              .filter(r=>r.linia===linia && r.kod===selectedKod);
  // ustaw CC pierwszego dopasowanego
  document.getElementById("cc").value = data.length>0 ? data[0].cc : "";
});
</script>
</body>
</html>
